!function(t,e){"function"==typeof define&&define.amd?define(e):t.Range=e()}(this,function(){"use strict";var t,e,n,i;return t=function(){var t="range-replacement-",e="is-active";return function(){var n=function(t){this._value=this._oldValue=t.value,this._width=t.width,this._track=t.track};return n.prototype={constructor:"Pointer",init:function(){return this._el=this._template(),this},activate:function(){this._el.classList.add(e)},deactivate:function(){this._el.classList.remove(e)},_template:function(){var e=document.createElement("div"),n=e.style;e.className=t+"point",n.position="absolute";var i=this._width;i&&(n.width=i+"px");var r=document.createElement("div");return r.className=t+"pointer-value",r.innerHTML=this._value,e.appendChild(r),this._valueEl=r,this._el=e,e},value:function(t){return arguments.length&&(this._oldValue=this._value,this._value=parseFloat(t),this._valueEl.innerHTML=t||"0"),this._value},oldValue:function(){return this._oldValue},width:function(t){return arguments.length&&(this._width=parseFloat(t),this._el.style.width=this._width+"px"),this._el.offsetWidth},left:function(t){return arguments.length&&(this._left=this._el.style.left=t+"%"),this._left||"0"},x:function(){return this._el.getBoundingClientRect().left},render:function(){return this._track.appendChild(this._el),this}},n}()}(),e={create:function(t,e){var n,i=this;return e=e||"HTMLEvents",n=document.createEvent?function(t){var n=document.createEvent(e);return n.initEvent(t,!1,!0),n}:function(t,e){var n=document.createEventObject(window.event);return n.cancelBubble=!0,n.eventType=t,n},i.create=n,n(t)},fire:function(t,e,n,i){var r,s=this;r=document.createEvent?function(t,e,n,i){var r=s.create(e,n);if("KeyboardEvent"===n){var a={get:function(){return i}},u=Object.defineProperty;u(r,"which",a),u(r,"keyCode",a)}t.dispatchEvent(r)}:function(t,e,n,i){var r=["on",e].join("");if("input"!==e){var a=s.create(e);a.keyCode=i,t.fireEvent(r,a)}else t[r]&&t[r]()},s.fire=r,r(t,e)}},n=function(t,e){var n=100,i=0,r=1,s="range-replacement-",a=function(t,e){var s=this;s.input=t,s.args=e||{},s._mode=s.args.range?"RANGE":"NUMBER",s.value=parseFloat(t.value),s.max=parseFloat(t.getAttribute("max"))||s.args.max||n,s.min=parseFloat(t.getAttribute("min"))||s.args.min||i,s.step=parseFloat(t.getAttribute("step"))||s.args.step||r};return a.prototype={constructor:"Range",init:function(t){return this._pointers=[],this._render(),this._bindEvents(),this._handleTicks(),this._setPointerValues(),this._lastPointer=this._pointers[0],this},_setPointerValues:function(){for(var t=this.input.value.split(","),e=0,n=t.length;e<n;e++)this._setValue(this._pointers[e],t[e],!0)},_handleTicks:function(){var t=this.args.ticks;if(t){if("[object Array]"===Object.prototype.toString.call(t))this._generateTicks(t);else if(t){t=[];for(var e=this.min,n=this.max;e<n;e+=this.step)t.push(e);this._generateTicks(t)}}else this._list()},_list:function(){var t,e,n,i=[];if((t=this.input.getAttribute("list"))&&(e=document.getElementById(t))){n=e.querySelectorAll("option");for(var r=0,s=n.length;r<s;r++)i.push(parseInt(n[r].innerHTML,10));this._generateTicks(i)}},_render:function(){var t=this.input;this.el=this._template(),t.style.display="none",t.parentNode.insertBefore(this.el,t.nextSibling),this._getDimensions();var e=this._getPointerWidth();this._pointers.forEach(function(t){t.width(e)}),this.track.style.paddingRight=e},_generateTicks:function(t){var e=document.createElement("div"),n=this._generateTicksInner();e.appendChild(n),e.className="ticks",this._generateTickEls(t,n),this.ticks=e,this.el.appendChild(this.ticks),this._styleTicks(e)},_styleTicks:function(t){var e=t.style;e.padding=["0",this.pointerWidth/2,"px"].join(""),e.width="100%",e.position="absolute"},_generateTicksInner:function(){var t=document.createElement("div"),e=t.style;return t.className="ticks-inner",e.width="100%",e.position="relative",t},_generateTickEls:function(t,e){for(var n,i,r=0;r<t.length;r++)i=t[r],n=this._scale(i,[this.min,this.max],[0,100]),e.appendChild(this._generateTick(n,i))},_generateTick:function(t,e){var n=document.createElement("div");return n.className="tick",n.innerHTML=e,n.style.position="absolute",n.style.left=t+"%",n},_generateSelected:function(){var t=document.createElement("div");return t.className=s+"selected",t.style.position="absolute",t},_getDimensions:function(){var t=this.el.getBoundingClientRect();this.xMin=t.left,this.xMax=t.right-this.xMin},_getPointerWidth:function(){return this.pointerWidth=this.args.pointerWidth||this._pointers[0].offsetWidth,this.pointerWidth+"px"},_template:function(){var e=this._rangeEl(),n="RANGE"===this._mode?2:1;this.track=this._trackEl(),this._selectedEl=this._generateSelected(),this.track.appendChild(this._selectedEl);for(var i,r=0,s=n;r<s;r++)i=new t({track:this.track,width:this.pointerWidth,value:null}).init().render(),this._pointers.push(i);return e.appendChild(this.track),e.addEventListener("selectstart",function(t){t.preventDefault()}),e},_rangeEl:function(){var t=document.createElement("div"),e=this.pointerWidth||0,n=t.style;return t.className="range-replacement",t.setAttribute("tabindex",0),n.position="relative",n.paddingRight=[e,"px"].join(""),t},_trackEl:function(){var t=document.createElement("div");return t.className="track",t},_pointerEl:function(){return new t({width:this.pointerWidth,value:50}).init()},_bindEvents:function(){var t,e=this,n=e.el;n.addEventListener("focus",function(t){e._focus(t)}),n.addEventListener("mousedown",function(t){var n=t.keyCode||t.which;if(1===n){var i=["mousedown","mousemove","mouseup"];e._dragStart(t,i,e._getMouseX)}e._focus(t)}),n.addEventListener("touchstart",function(n){t=["touchstart","touchmove","touchend"],e._dragStart(n,t,e._getTouchX)}),n.addEventListener("mouseup",function(){e._dragEnd("mouseup")}),n.addEventListener("touchend",function(){e._dragEnd("touchend")})},_focus:function(){var t=this;t.hasFocus||(t.hasFocus=!0,e.fire(t.input,"focus"),t.keydown=function(e){t._keydown(e)},t.keyup=function(n){e.fire(t.input,"keyup","KeyboardEvent",n.keyCode||n.charCode)},t.blur=function(e){t._clickBlur(e)},document.addEventListener("keydown",t.keydown),document.addEventListener("keyup",t.keyup),window.addEventListener("mousedown",t.blur))},_keydown:function(t){var n=t.keyCode||t.charCode,i=this,r=i._lastPointer;40===n||37===n?i._setValue(r,r.value()-i.step):38===n||39===n?i._setValue(r,r.value()+i.step):9===n&&i._blur(),e.fire(this.input,"keydown","KeyboardEvent",n)},_clickBlur:function(t){for(var e=this,n=e.input,i=e.el,r=i.querySelectorAll("*"),s=[],a=0,u=r.length;a<u;a++)s.push(r[a]);s.push(i,n),s.indexOf(t.target)<0&&e._blur()},_blur:function(){var t=this;t.hasFocus=!1,window.removeEventListener("mousedown",t.blur),document.removeEventListener("keydown",t.keydown),document.removeEventListener("keyup",t.keyup),e.fire(t.input,"blur")},update:function(t){return this.value=this._roundAndLimit(parseFloat(this.input.value)),this._getDimensions(),this._setValue(this._pointers[0],this.value,t),this},_preventSelection:function(){var t,e=this;t="undefined"!=typeof e.el.onselectstart?function(){document.body.style.cursor="default",window.addEventListener("selectstart",e.noSelect=function(t){t.preventDefault()})}:function(){var t=document.body.style;t.cursor="default",t.MozUserSelect="none"},e._preventSelection=t,t()},_allowSelection:function(){var t,e=this;t="undefined"!=typeof e.el.onselectstart?function(){document.body.style.cursor="",window.removeEventListener("selectstart",e.noSelect)}:function(){var t=document.body.style;t.cursor="",t.MozUserSelect=""},e._allowSelection=t,t()},_dragStart:function(t,n,i){var r,s,a=this,u=n[1],o=n[2];t.preventDefault();var l=i.call(a,t),c=this._pointers.sort(function(t,e){var n=Math.abs(l-t.x()),i=Math.abs(l-e.x());return n>i?1:-1}),h=c[0];h.activate(),a.oldValue=a.value,a._input(h,i.call(a,t)),window.addEventListener(u,r=function(t){a._input(h,i.call(a,t))}),a._preventSelection(),window.addEventListener(o,s=function(){a._change(),window.removeEventListener(u,r),window.removeEventListener(o,s),a._allowSelection(),document.body.style.cursor=""}),e.fire(a.input,n[0])},_dragEnd:function(t){this._change(),this._pointers.forEach(function(t){t.deactivate()}),e.fire(this.input,t),e.fire(this.input,"click")},_getMouseX:function(t){var e;return e="undefined"==typeof window.event?function(t){return t.pageX}:function(){return window.event.clientX},this._getMouseX=e,e(t)},_getTouchX:function(t){return t.changedTouches[0].clientX},_input:function(t,e){this._getDimensions();var n=e-this.xMin,i=[0,this.xMax],r=[this.min,this.max],s=this._scale(n,i,r);this._setValue(t,s)},_setValue:function(t,n,i){var r=this;if(r._lastPointer=t,n=r._roundAndLimit(n),n!==t.oldValue()){t.value(n),r.oldInputValue=r.newValue=n,r.input.value=r.inputValue();var s=r.min,a=(n-s)/(r.max-s)*100||0;t.left(a),r.oldValue&&!i&&e.fire(r.input,"input"),r._updateSelected(),r._change(i)}},_updateSelected:function(){"RANGE"===this._mode?this._updateRangeSelected():"NUMBER"===this._mode&&this._updateNumberSelected()},_updateNumberSelected:function(){var t=this._selectedEl;t.style.left=0,t.style.width=this._pointers[0].left()},_updateRangeSelected:function(){var t=this._selectedEl,e=this._pointers,n=[0,1].sort(function(t,n){return e[t].value()>e[n].value()?1:-1});t.style.left=e[n[0]].left(),t.style.width=parseInt(e[n[1]].left())-parseInt(e[n[0]].left())+"%"},_change:function(t){var n=this.inputValue(),i=this.input;this.oldValue!==n&&(i.value=this.oldValue=this.value=n,t||e.fire(i,"change"))},inputValue:function(){var t,e=this._mode;return"NUMBER"===e&&(t=this._numberValue()),"RANGE"===e&&(t=this._rangeValue()),t},_numberValue:function(){return this._pointers[0].value()},_rangeValue:function(){var t=this._pointers.map(function(t){return t.value()});return t.sort(function(t,e){return t>e})},_roundAndLimit:function(t){var e=this.step,n=(e+"").split(".")[1],i=n?n.length:0,r=(Math.round(t/e)*e).toFixed(i);return Math.min(Math.max(r,this.min),this.max)},_scale:function(t,e,n){var i=e[0],r=n[0],s=n[1],a=(t-i)/(e[1]-i);return a*(s-r)+r}},a}(t,e),i=function(t){return{init:function(e,n,i){e=e||"input[type=range]";var r=[];if("string"==typeof e)e=document.querySelectorAll(e);else if("undefined"==typeof e.length)return new t(e,n).init(i);for(var s=0,a=e.length;s<a;s++)r.push(new t(e[s],n).init(i));return r}}}(n)});